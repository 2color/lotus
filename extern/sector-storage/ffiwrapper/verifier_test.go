package ffiwrapper

import (
	"encoding/json"
	"testing"

	ffi "github.com/filecoin-project/filecoin-ffi"
	"github.com/filecoin-project/specs-actors/v7/actors/runtime/proof"
	"github.com/stretchr/testify/assert"
)

func benchmarkESUProof(b *testing.B, data string) {
	var rui proof.ReplicaUpdateInfo
	json.Unmarshal([]byte(data), &rui)
	res, err := ffi.SectorUpdate.VerifyUpdateProof(rui)
	assert.True(b, res)
	assert.NoError(b, err)
	b.ResetTimer()
	for i := 0; i < b.N; i++ {
		res, err = ffi.SectorUpdate.VerifyUpdateProof(rui)
		assert.True(b, res)
		assert.NoError(b, err)
	}
}
func BenchmarkVerifyESU32G(b *testing.B) {
	benchmarkESUProof(b, proof32G)
}
func BenchmarkVerifyESU512M(b *testing.B) {
	benchmarkESUProof(b, proof512M)
}

var proof32G = `{"UpdateProofType":3,"OldSealedSectorCID":{"/":"bagboea4b5abca32jm6egelzfjj7vodwngv3oiqfaqll2vvc4w7v4qjphkofcpati"},"NewSealedSectorCID":{"/":"bagboea4b5abcbtobo2hvbjgnljc43bgmjkve2wavqwn3gan7bu5ukwmk3o5btyc4"},"NewUnsealedSectorCID":{"/":"baga6ea4seaqllplkee7olqkxhgpjrdbxmvoqwhmvlbybwp56qj47sg2gliku2my"},"Proof":"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"}`
var proof512M = `{"UpdateProofType":2,"OldSealedSectorCID":{"/":"bagboea4b5abcbqklviz44vvgnfqlu2pwyhshc2tebs5f6i4wu2gjfkvtjvp6zvib"},"NewSealedSectorCID":{"/":"bagboea4b5abcb3ometx5qqpdfyvgi6w3r74yppfb2pxrv4hizrlmg5necihjfvbc"},"NewUnsealedSectorCID":{"/":"baga6ea4seaqo4new7ivl265fgmksiom34celmv4ubdvagzqyvag7dkuoeuyiwpq"},"Proof":"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"}`
